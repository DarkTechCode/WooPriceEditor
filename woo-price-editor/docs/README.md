# Документация Редактора цен WooCommerce

Добро пожаловать в документацию Редактора цен WooCommerce. Этот каталог содержит комплексные руководства, охватывающие все аспекты плагина.

## Указатель документации

### Начало работы

- **[Руководство по установке](installation.md)** — пошаговые инструкции по установке, требования, настройка после установки и решение проблем

### Конфигурация

- **[Документация по настройкам](settings.md)** — полное руководство по параметрам плагина, включая стартовую категорию, колонки по умолчанию и настройку инструкций

- **[Справочник прав доступа](capabilities.md)** — детальное объяснение прав пользователей, проверки прав и контроля доступа

### Разработка

- **[Конечные точки AJAX](ajax-endpoints.md)** — полный справочник API для всех конечных точек AJAX с примерами запросов/ответов, аутентификацией и безопасностью

- **[Технические заметки](technical-notes.md)** — детали реализации, включая встроенный jQuery WordPress, полноэкранный рендеринг, архитектуру безопасности и руководства по расширениям

### Тестирование

- **[Запуск тестов](../tests/README.md)** — документация набора тестов PHPUnit с инструкциями по установке и примерами

## Краткий справочник

### Требования системы

- **WordPress**: 6.0 или выше
- **PHP**: 7.4 или выше
- **WooCommerce**: 3.0 или выше
- **Право пользователя**: `manage_woocommerce`

### Установка

1. Загрузите плагин в `/wp-content/plugins/woo-price-editor/`
2. Активируйте через администратор WordPress
3. Доступ через меню **Редактор цен**
4. Настройте параметры по необходимости

Подробные инструкции смотрите в [Руководстве по установке](installation.md).

### Ключевые возможности

- **Полноэкранный редактор**: интерфейс без отвлечений для массового редактирования
- **Встроенное редактирование**: нажмите на поля для редактирования прямо в таблице
- **Расширенная фильтрация**: фильтры по категориям, статусу, налогам, наличию плюс поиск
- **Настраиваемые колонки**: показать/скрыть колонки, настроить по умолчанию
- **Безопасность**: контроль доступа на основе прав, проверка nonce, санитизация входных данных
- **AJAX API**: быстрые, безопасные операции с товарами

### Архитектура

```
Загрузчик плагина (woo-price-editor.php)
    ↓
WPE_Plugin (основной контроллер)
    ├── Меню администратора и полноэкранный рендеринг
    ├── Загрузка ресурсов (CSS/JS)
    └── Инициализация параметров
        ↓
Обработчики AJAX (WPE_AJAX)
    ├── Проверка безопасности
    ├── Получение категорий/налоговых классов/товаров
    └── Обновление полей товаров
        ↓
Обработчик товаров (WPE_Product)
    ├── Получение данных
    └── Обновления полей (через API WooCommerce)
        ↓
Слой безопасности (WPE_Security)
    ├── Санитизация полей
    ├── Проверки прав доступа
    └── Логирование событий
```

### Модель безопасности

Все операции требуют:
1. ✓ Аутентифицированный пользователь (вошедший)
2. ✓ Действительный nonce (`wp_rest`)
3. ✓ Право `manage_woocommerce`
4. ✓ Права товара (для обновлений)

Подробнее смотрите в [Справочнике прав доступа](capabilities.md).

### Сводка конечных точек AJAX

| Конечная точка | Назначение | Требуется аутентификация |
|---|---|---|
| `wpe_get_categories` | Получить категории товаров | ✓ |
| `wpe_get_tax_classes` | Получить налоговые классы | ✓ |
| `wpe_get_products` | Получить товары с фильтрами | ✓ |
| `wpe_update_product` | Обновить поле товара | ✓ |

Полный справочник API смотрите в [Конечных точках AJAX](ajax-endpoints.md).

### Обзор параметров

| Параметр | По умолчанию | Описание |
|---|---|---|
| Стартовая категория | Все товары | Категория, выбранная при загрузке редактора |
| Колонки по умолчанию | sku, regular_price, sale_price, stock_status, tax_status | Видимые по умолчанию колонки |
| Инструкции | Встроенный текст справки | Настраиваемая справка, отображаемая пользователям |

Подробности конфигурации смотрите в [Документации по настройкам](settings.md).

## Обычные задачи

### Изменить видимые колонки по умолчанию

1. Перейдите в **Редактор цен** → **Настройки**
2. Установите/снимите флажки колонок в разделе «Видимые колонки»
3. Нажмите **Сохранить изменения**

### Установить фильтр категории по умолчанию

1. Перейдите в **Редактор цен** → **Настройки**
2. Выберите категорию из выпадающего списка «Стартовая категория»
3. Нажмите **Сохранить изменения**

### Настроить инструкции для пользователей

1. Перейдите в **Редактор цен** → **Настройки**
2. Отредактируйте текст в поле «Инструкции редактора»
3. Нажмите **Сохранить изменения**

### Предоставить доступ пользовательской роли

```php
$role = get_role('custom_role');
if ($role) {
    $role->add_cap('manage_woocommerce');
}
```

Подробнее о разрешениях смотрите в [Справочнике прав доступа](capabilities.md).

### Тестировать конечную точку AJAX

```javascript
// В консоли браузера на странице редактора
jQuery.post(wpeData.ajaxUrl, {
    action: 'wpe_get_products',
    nonce: wpeData.nonce,
    page: 1,
    per_page: 10
}, function(response) {
    console.log(response);
});
```

Подробности API смотрите в [Конечных точках AJAX](ajax-endpoints.md).

## Решение проблем

### Не видна папка меню Редактор цен

**Проблема**: пункт меню не видна в администраторе WordPress

**Причины**:
- Пользователь не имеет права `manage_woocommerce`
- Плагин не активирован

**Решения**:
- Проверьте роль пользователя (Администратор или менеджер магазина)
- Проверьте страницу плагинов, чтобы подтвердить активацию

### Товары не загружаются

**Проблема**: редактор загружается, но товары не отображаются

**Причины**:
- WooCommerce не установлен/активирован
- Нет товаров в базе данных
- Ошибка JavaScript

**Решения**:
- Активируйте WooCommerce
- Создайте тестовые товары
- Проверьте консоль браузера на ошибки

### Ошибки прав доступа

**Проблема**: сообщения об ошибках «У вас нет прав»

**Причины**:
- Невалидный или истекший nonce
- Пользователь не имеет право
- Проблема с правами товара

**Решения**:
- Обновите страницу для получения нового nonce
- Проверьте, что пользователь имеет право `manage_woocommerce`
- Проверьте, может ли пользователь редактировать конкретный товар в администраторе WP

### Страница редактора пуста

**Проблема**: при нажатии на Редактор цен отображается пустая страница

**Причины**:
- Ошибка PHP
- Отсутствует файл шаблона
- Конфликт с темой/плагином

**Решения**:
- Включите WP_DEBUG и проверьте логи ошибок
- Убедитесь, что `templates/editor-shell.php` существует
- Отключите другие плагины для выявления конфликтов

Подробнее ищите в отдельных файлах документации.

## Ресурсы для разработчиков

### Расширение плагина

```php
// Добавить пользовательские данные в контекст редактора
add_filter('wpe_editor_context', function($context) {
    $context['my_custom_data'] = get_my_data();
    return $context;
});
```

### Добавление пользовательской конечной точки AJAX

```php
add_action('wp_ajax_wpe_custom_action', function() {
    // Проверить разрешения с помощью существующего обработчика
    $ajax = new WPE_AJAX();
    // ... ваша логика
});
```

Смотрите [Технические заметки](technical-notes.md) для примеров расширений.

### Запуск тестов

```bash
# Установить набор тестов WordPress
export WP_TESTS_DIR=/tmp/wordpress-tests-lib

# Запустить все тесты
cd woo-price-editor/tests
phpunit

# Запустить конкретный тест
phpunit test-option-defaults.php
```

Подробнее смотрите в [Документации по тестам](../tests/README.md).

## Дополнительные ресурсы

### Документация WordPress
- [Справочник плагинов](https://developer.wordpress.org/plugins/)
- [AJAX в плагинах](https://developer.wordpress.org/plugins/javascript/ajax/)
- [Settings API](https://developer.wordpress.org/plugins/settings/settings-api/)

### Документация WooCommerce
- [Документация WooCommerce](https://woocommerce.com/documentation/)
- [Product CRUD](https://github.com/woocommerce/woocommerce/wiki/CRUD-Objects-in-3.0)

### Используемые библиотеки
- [DataTables](https://datatables.net/)
- [jQuery](https://jquery.com/)

## Вклад в проект

При внесении вклада в плагин:

1. Прочитайте всю документацию для понимания архитектуры
2. Следуйте стандартам кодирования WordPress
3. Напишите тесты для новых функций
4. Обновите документацию для изменений
5. Тестируйте на поддерживаемых версиях WordPress/PHP

## Поддержка

По вопросам и проблемам:

1. Проверьте документацию в этом каталоге
2. Просмотрите [Технические заметки](technical-notes.md) для деталей реализации
3. Поищите существующие проблемы
4. Откройте новую проблему с деталями

---

**Последнее обновление**: декабрь 2024  
**Версия плагина**: 0.1.0  
**Совместимость WordPress**: 6.0+
